---
published: true

layout: single

title: "[23-04-11] 2. 와핑 기법과 원근 변환"

categories: [Devcourse-TIL, CV]

tags: Autonomous_Driving CV

toc: true

toc_label : 목차

toc_sticky: true

author_profile: false

sidebar :
    nav : "docs"
---

### 와핑 기법과 원근 변환



#### 이미지의 기하학적 변형 기법 : 와핑(Warping)

- 사전적으로 뒤틀림, 왜곡하다라는 의미로 영상 시스템에서 영상을 이동, 회전, 크기 변환 등을 이용해 이미지를 찌그러뜨리거나 반대로 찌그러진 이미지를 복원하기 위한 처리 기법



![image](https://user-images.githubusercontent.com/116723552/231557792-14d1fa40-ace5-4db7-b5eb-53ecf09d36dc.png)



#### 다양한 이미지 변형 방법

- 변환(Transformations)
  - 좌표 x를 새로운 좌표 x'로 변환하는 함수
  - 사이즈 변경(Scaling), 위치변경(Translation), 회전(Rotation) 등등



1. 강체변환 (Rigid-Body) : 크기 및 각도가 보존되는 변환 (ex. Translation, Rotation)
2. 유사변환 (Similarity) : 크기는 변하고 각도는 보존되는 변환 (ex. Scaling)
3. 선형변환 (Linear) : Vector 공간에서의 이동
4. Affine : 선형변환과 이동변환까지 포함하지만 선의 수평성은 유지함 (ex. 사각형 -> 평행사변형)
5. Perspective : Affine 변환에서 수평성도 유지되지 않음. 원근변환



<img src="https://user-images.githubusercontent.com/116723552/231565639-efba975c-c79c-4d70-9d01-60a5ead3d962.png" alt="image" style="zoom:80%;" />



<img src="https://user-images.githubusercontent.com/116723552/231566754-d6130677-b906-4b14-b4dd-8b36d502b605.png" alt="image" style="zoom:80%;" />



#### Translation 변환

- 평행이동

  - 이미지를 이동하려면 원래 있던 좌표에 이동시키려는 거리만큼 더하면 됨
    - x_new = x_old + d1
    - y_new = y_old + d2
  - 위 방정식을 행렬식으로 표현하면 (컴퓨터의 연산을 위해)

  ![image](https://user-images.githubusercontent.com/116723552/231567440-ce3ef5c1-9e07-43b3-8e71-42425e3ff683.png)

  - 행렬식을 다시 풀어 작성하면
    - x_new = x_old + d1 = 1 * x_old + 0 * y_old + d1
    - y_new = y_old + d2 = 0 * x_old + 1 * y_old + d2
    
    

- 변환행렬을 사용하는 OpenCV 함수

  - dst = cv2.warpAffine(src, matrix, dsize, dst, flags, borderMode, borderValue)

    - src : 원본 이미지(numpy 배열)
    - matrix : 2 x 3 변환 행렬 (dtype = float32)
    - dsize : 결과 이미지의 크기 (width, height)
    - dst (optional) : 결과 이미지
    - flags (optional) : 보간법 알고리즘 플래그
    - borderMode (optional) : 외곽영역 보정 플래그 / 사진이 이동했을 때 빈 공간을 어떻게 채울 것인지 결정하는 것
    - borderValue (optional) : 외곽영역 보정 플래그가 cv2.Border_CONSTANT일 경우 사용할 색상의 값 (default = 0)

    - 리턴 값은 결과 이미지로 `dst = cv2.warpAffine(img, M, (cols,rows))` 처럼 사용할 수 있음

<img src="https://user-images.githubusercontent.com/116723552/231569149-e4d889da-9e38-4793-b943-7acb88829f41.png" alt="image" style="zoom:80%;" />



#### 확대 / 축소 

- 일정 비율로 확대 및 축소
  - 기존 좌표에 특정 값을 곱하면 됨
    - x_new = a1 * x_old = a1 * x_old + 0 * y_old + 0 * 1
    - y_new = a2 * y_old = 0 * x_old + a2 * y_old + 0 * 1
  - 위 방정식을 행렬식으로 표현하면

![image](https://user-images.githubusercontent.com/116723552/231571595-dcb251d1-50d5-4277-99e3-2486d079a700.png)

#### 확대 / 축소 방법 2

- 크기 조정 OpenCV 함수 사용
  - cv2.resize(src, dsize, dst, fx, fy, interpolation)
    - src : 원본 이미지(numpy 배열)
    - dsize : 확대/축소를 원하는 목표 이미지의 크기 (width, height) / 생략시 fx , fy 배율을 적용
    - dst : 결과 이미지
    - fx, fy : 변경할 크기 배율로 fx =2, fy =0.5를 넣으면 x축으로 2 배, y축으로 0.5 배로 스케일링 함 / dsize가 주어지면 dsize를 우선 적용
    - interpolation : 보간법 알고리즘 선택 플래그 (cv2.warpAffine()과 동일)



#### 회전

- 이미지 회전을 위한 변환 행렬식
  - 사인함수와 코사인함수를 이용해서 변환
  - 일반적인 회전 행렬은 2 x 2 행렬이므로 Affine 에서 사용할 수 없음
  - 따라서 2 x 3 행렬을 만들어 사용
  - 





#### 패키지 생성

- `$ catkin_create_pkg sliding_drive std_msgs rospy`



- 평행이동
  - translation.py

<img src="https://user-images.githubusercontent.com/116723552/231570115-cfa2d0fc-d628-4aa3-a0fc-bac78e1c2142.png" alt="image" style="zoom:80%;" />



- 실행결과

<img src="https://user-images.githubusercontent.com/116723552/231570791-1f4dbcaf-161a-434e-9fcd-0af585c98349.png" alt="image" style="zoom:80%;" />



- 확대 / 축소
  - scaling.py

<img src="https://user-images.githubusercontent.com/116723552/231571706-1567934e-f6fd-4866-94a0-9822c641cb0e.png" alt="image" style="zoom:80%;" />



- 실행결과
  - #1. 원본
  - #2. 그냥 축소
  - #3. 보간법 적용한 축소
  - #4. 그냥 확대
  - #5. 보간법 적용한 확대

<img src="https://user-images.githubusercontent.com/116723552/231571870-48f990f2-d411-42c8-a9e0-acf72971e6c1.png" alt="image" style="zoom:80%;" />



- 확대 / 축소 2
  - resizing.py

<img src="https://user-images.githubusercontent.com/116723552/231573447-088cbdf8-eea7-4f0f-9e48-838876435470.png" alt="image" style="zoom:80%;" />

- 실행결과

<img src="https://user-images.githubusercontent.com/116723552/231573686-f632ddbf-e355-40ff-9d66-6b2f10bec550.png" alt="image" style="zoom:80%;" />



- 회전

  - rotation1.py

  



